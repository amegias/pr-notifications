# Contributing

## How to develop

The core of this action is placed in `src/get-notifications.ts`.
This code can be executed in different ways:
- [Locally](#how-to-debug-it-locally): to be debugged
- [Automatically with tests](#how-to-execute-the-tests): to check if everything works as expected.
- [As a GitHub action](#how-to-execute-it-as-a-github-action): to check if it is integrated/called properly.

## How to debug it locally
You can execute the action starting from `dev-index.ts` which have the right environment:
- Dependencies
- Input: env vars

Before executing it, we need to provide an `.env` file with:
```bash
REPO_NAME = "" # your repo or a public repo.
REPO_OWNER = "" # the owner of the repo.
ACCESS_TOKEN = "" # the token got from https://github.com/settings/tokens?type=beta. It must have read permissions for repositories.
DEFAULT_TTL = "259200" # for example, 3 days.
LABELS_TTL = '{ "bug": "86400" }'
PULL_REQUEST_NUMBER = "" # if you want to execute it checking only that pull request or all of them.
LABEL_TO_SKIP_PR = "skip-notifications" # If a pull request has this label, the reviewers will not be notified.
```

Then:

```shell
npm run dev
```

## How to execute the tests
You can run:
```shell
npm test
```
It will execute the tests to check if everything is ok.
This flow is already executed in every push as a GitHub action.

## How to execute it as a GitHub action
### How to build the action
The build is auto-generated by the [build](./.github/workflows/build.yaml) action (Anyway, you can do it manually with `npm run build`).
The artifact is placed in `dist/`.

IMPORTANT: it is based on `src/index.ts` which is the entry point with the GitHub dependencies/inputs like `@actions/core`, `@actions/github` or the GitHub logger.

### Execute it in the GitHub actions console
Use the [`example.yml`](./.github/workflows/example.yaml) action, which contains an example of use case. This action can be executed manually from [the console](https://github.com/amegias/pr-notifications/actions/workflows/private-example.yml).

## How to release
Just tag the `HEAD` of `main` with the right version:
```shell
git tag -a -m "{message}" vX.X
```
After that, the action will be available from any repository.
